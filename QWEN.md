# AVM2 项目知识库

## 第一性原理

### 语义自举核心设计
1. **三界分离**：实在界（物理世界反馈）、想象界（语义处理）、象征界（知识库）
2. **微Agent架构**：RNA式原初实体，主体性极弱，不决策不规划
3. **语义-实在转换**：系统Agent是实在界与想象界的交界点，负责忠实转换而非复杂处理
4. **表达能力等价性**：新Agent表达能力 ≥ 原Agent表达能力

### 系统设计原则
1. **抽象类与具体实现分离**：InputAgent/OutputAgent是抽象基类，具体实现在system_interface_agents中
2. **语义体系与编程体系分离**：YAML配置描述语义，Python类实现逻辑
3. **文件同步机制**：所有Agent类必须实现sync_to_file和sync_from_file方法
4. **动态类型创建**：使用eval(class_name)根据YAML配置动态创建Agent实例

## 代码风格与工程实践

### Python最佳实践
1. **类型注解**：所有方法参数和返回值使用类型注解
2. **抽象基类**：使用ABC和abstractmethod定义接口
3. **异步编程**：统一使用async/await处理异步操作
4. **异常处理**：明确的错误处理和用户友好的错误信息
5. **模块化设计**：driver/包含核心组件，system_interface_agents/包含具体实现

### 项目结构规范
```
AVM2/
├── driver/                    # 核心组件
│   ├── driver.py             # Agent基类、消息总线
│   ├── system_agents.py      # 系统Agent抽象类
│   └── async_system.py       # 异步系统
├── system_interface_agents/  # 系统Agent具体实现
├── Agents/                   # Agent配置
│   ├── *.yaml               # 普通Agent
│   └── SystemAgents/        # 系统Agent配置
└── main.py                  # 系统入口
```

### 文件交互设计
1. **YAML格式**：人类可读的Agent配置格式
2. **统一接口**：所有Agent类实现相同的文件同步方法
3. **语义持久化**：只保存语义体系相关的属性（ID、提示词、连接关系等）
4. **类名映射**：SystemAgent的YAML文件必须包含class_name字段

## 关键洞察与教训

### 设计洞察
1. **伪代码理解**：伪代码是示意，不能运行，需要实现为可执行代码
2. **简单性原则**：避免过度设计，直接实现需求
3. **扩展性平衡**：在简单性和扩展性之间找到平衡点
4. **动态类型使用**：Python的eval()可以简化动态对象创建

### 工程教训
1. **不要硬编码**：使用配置驱动而非硬编码逻辑
2. **理解抽象类**：抽象类不能直接实例化，需要具体实现
3. **保持代码简洁**：避免不必要的复杂性
4. **测试驱动**：先确保代码能运行，再考虑优化

## 系统启动流程

1. **扫描配置**：递归扫描Agents文件夹下的所有YAML文件
2. **动态创建**：根据class_name使用eval()创建Agent实例
3. **状态同步**：调用sync_from_file加载Agent状态
4. **系统注册**：将Agent注册到AgentSystem
5. **启动运行**：启动消息总线，运行系统

## 语义自举机制

### 激活机制
- **主体激活**：主动拉取依赖信息
- **被动激活**：监听消息响应
- **触发激活**：时间/语境联想触发

### 演化机制
- **奖励事件**：成功行为生成奖励，信用分配
- **淘汰机制**：长期无效Agent被标记删除
- **变异重组**：变异Agent引入新语义片段

## 未来扩展方向

1. **进化算法集成**：实现更复杂的信用分配和淘汰机制
2. **语义修复**：LLM在演化过程中的角色优化
3. **多模态支持**：扩展支持图像、音频等输入输出
4. **分布式架构**：支持多节点Agent系统

---

**更新日期**：2025-10-03  
**核心原则**：语义自举、三界分离、微Agent架构、动态类型创建